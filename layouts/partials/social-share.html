{{ $url := .Permalink }}
{{ $title := .Title }}

<div class="share-icons">
    
    <a class="share-link share-facebook" 
       href="https://facebook.com/sharer/sharer.php?u={{ $url | absURL }}" 
       target="_blank" rel="noopener" aria-label="share facebook">
        <span class="share-icon">
            <svg viewBox="0 0 24 24"><path d="M18.77 7.46H14.5v-1.9c0-.9.6-1.1 1-1.1h3V.5h-4.33C10.24.5 9.5 3.44 9.5 5.32v2.15h-3v4h3v12h5v-12h3.85l.42-4z"></path></svg>
        </span>
    </a>
    
    <a class="share-link share-x" 
       href="https://x.com/intent/tweet/?text={{ $title | urlquery }}&amp;url={{ $url | absURL }}" 
       target="_blank" rel="noopener" aria-label="share x">
        <span aria-hidden="true" class="share-icon">
            <svg viewBox="0 0 24 24"><path d="M8 2H1l8.26 11.015L1.45 22H4.1l6.388-7.349L16 22h7l-8.608-11.478L21.8 2h-2.65l-5.986 6.886zm9 18L5 4h2l12 16z"></path></svg>
        </span>
    </a>
    
    <a class="share-link share-email" 
       href="mailto:?subject={{ $title | urlquery }}&amp;body={{ $url | absURL }}" 
       target="_self" rel="noopener" aria-label="share email">
        <span aria-hidden="true" class="share-icon">
            <svg viewBox="0 0 24 24"><path d="M22 4H2C.9 4 0 4.9.0 6v12c0 1.1.9 2 2 2h20c1.1.0 2-.9 2-2V6c0-1.1-.9-2-2-2zM7.25 14.43l-3.5 2c-.08.05-.17.07-.25.07-.17.0-.34-.1-.43-.25-.14-.24-.06-.55.18-.68l3.5-2c.24-.14.55-.06.68.18.14.24.06.55-.18.68zm4.75.07c-.1.0-.2-.03-.27-.08l-8.5-5.5c-.23-.15-.3-.46-.15-.7.15-.22.46-.3.7-.14L12 13.4l8.23-5.32c.23-.15.54-.08.7.15.14.23.07.54-.16.7l-8.5 5.5c-.08.04-.17.07-.27.07zm8.93 1.75c-.1.16-.26.25-.43.25-.08.0-.17-.02-.25-.07l-3.5-2c-.24-.13-.32-.44-.18-.68s.44-.32.68-.18l3.5 2c.24.13.32.44.18.68z"></path></svg>
        </span>
    </a>
    
    <span class="fediverse-share">
        <a class="share-link share-fediverse" href="javascript:void(0);" onclick="toggleFediverseInput(this)" aria-label="share fediverse">
            <span aria-hidden="true" class="share-icon">
                <svg viewBox="-10 -5 1034 1034" xmlns:xlink="http://www.w3.org/1999/xlink"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"><path d="M539 176q-32 0-55 22t-25 55 20.5 58 56 27 58.5-20.5 27-56-20.5-59T544 176h-5zm-87 95-232 118q20 20 25 48l231-118q-19-20-24-48zm167 27q-13 25-38 38l183 184q13-25 39-38zM477 320 342 585l40 40 143-280q-28-5-48-25zm104 16q-22 11-46 10l-8-1 21 132 56 9zM155 370q-32 0-55 22.5t-25 55 20.5 58 56.5 27 59-21 26.5-56-21-58.5-55.5-27h-6zm90 68q1 9 1 18-1 19-10 35l132 21 26-50zm225 36-26 51 311 49q-1-8-1-17 1-19 10-36zm372 6q-32 1-55 23t-24.5 55 21 58 56 27 58.5-20.5 27-56.5-20.5-59-56.5-27h-6zM236 493q-13 25-39 38l210 210 51-25zm-40 38q-21 11-44 10l-9-1 40 256q21-10 45-9l8 1zm364 22 48 311q21-10 44-9l10 1-46-294zm195 23-118 60 8 56 135-68q-20-20-25-48zm26 49-119 231q28 5 48 25l119-231q-28-5-48-25zM306 654l-68 134q28 5 48 25l60-119zm262 17-281 143q19 20 24 48l265-135zM513 771l-51 25 106 107q13-25 39-38zM222 795q-32 0-55.5 22.5t-25 55 21 57.5 56 27 58.5-20.5 27-56-20.5-58.5-56.5-27h-5zm89 68q2 9 1 18-1 19-9 35l256 41q-1-9-1-18 1-18 10-35zm335 0q-32 0-55 22.5t-24.5 55 20.5 58 56 27 59-21 27-56-20.5-58.5-56.5-27h-6z"></path></g></svg>
            </span>
        </a>
        <span class="fediverse-input-wrapper" style="display:none">
            <input type="text" placeholder="Enter Fediverse Instance URL" class="fediverse-input" 
                   onkeypress="handleFediverseShare(event,'{{ $url | absURL }}','{{ $title | safeJS }}')">
            <button class="fediverse-check-button" onclick="handleFediverseShareButton(this,'{{ $url | absURL }}','{{ $title | safeJS }}')">
                Share
            </button>
        </span>
    </span>
    
    <button class="share-link share-copy" onclick="copyToClipboard(this,'{{ $url | absURL }}')">
        <span class="share-icon">
            <svg viewBox="0 0 24 24"><path d="M19 3h-4.18C14.4 1.84 13.3 1 12 1s-2.4.84-2.82 2H5c-1.1.0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1.0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-7-1c.55.0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zm7 17H5V5h14v14z"></path></svg>
        </span>
    </button>
</div>

<script>
    function toggleFediverseInput(e){
        const n=e.closest(".fediverse-share"),t=n.querySelector(".fediverse-input-wrapper");
        t.style.display=t.style.display==="none"?"block":"none";
    }

    function handleFediverseShare(e,t,n){
        if(e.key==="Enter"){
            const o=e.target;let s=o.value.trim();
            if(s){
                s.startsWith("https://")||(s=`https://${s}`);
                const e=`${s}/share?text=${encodeURIComponent(n)}&url=${encodeURIComponent(t)}`;
                window.open(e,"_blank","noopener");
            }
        }
    }
    
    function handleFediverseShareButton(e,t,n){
        const o=e.previousElementSibling;let s=o.value.trim();
        if(s){
            s.startsWith("https://")||(s=`https://${s}`);
            const e=`${s}/share?text=${encodeURIComponent(n)}&url=${encodeURIComponent(t)}`;
            window.open(e,"_blank","noopener");
        }
    }
    
    function copyToClipboard(e,t){
        navigator.clipboard.writeText(t).then(()=>{
            const t=e.querySelector("svg path"),n="M19 3h-4.18C14.4 1.84 13.3 1 12 1s-2.4.84-2.82 2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-7-1c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zm7 17H5V5h14v14z",s="M9 16.2l-3.5-3.5-1.4 1.4L9 19 20 8l-1.4-1.4L9 16.2z";
            t.setAttribute("d",s),setTimeout(()=>{t.setAttribute("d",n)},1e3);
        });
    }
</script>
